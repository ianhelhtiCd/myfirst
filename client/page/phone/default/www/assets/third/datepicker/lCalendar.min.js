var hlCalendar={params:{minY:1900,minM:1,minD:1,maxY:2099,maxM:12,maxD:31}};var passY=hlCalendar.params.maxY-hlCalendar.params.minY+1;function editDate(f){hlCalendar.listener=f.target;hlCalendar.gearDate=document.querySelector(".gearDate");if(!hlCalendar.gearDate){hlCalendar.gearDate=document.createElement("div");hlCalendar.gearDate.className="gearDate";hlCalendar.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn" onclick="cancelDateEdit();">取消</div><div class="date_btn" onclick="finishDateEdit();">确定</div></div><div class="date_roll_mask"><div class="date_roll"><div><div class="gear date_yy" data-datetype="date_yy" ontouchstart="gearTouchStart(event)" ontouchmove="gearTouchMove(event)" ontouchend="gearTouchEnd(event)" onmousewheel="gearScroll(event)"></div><div class="date_grid" onmousewheel="gearScroll(event)"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm" ontouchstart="gearTouchStart(event)" ontouchmove="gearTouchMove(event)" ontouchend="gearTouchEnd(event)" onmousewheel="gearScroll(event)"></div><div class="date_grid" onmousewheel="gearScroll(event)"><div>月</div></div></div><div><div class="gear date_dd" data-datetype="date_dd" ontouchstart="gearTouchStart(event)" ontouchmove="gearTouchMove(event)" ontouchend="gearTouchEnd(event)" onmousewheel="gearScroll(event)"></div><div class="date_grid" onmousewheel="gearScroll(event)"><div>日</div></div></div></div></div></div>';document.body.appendChild(hlCalendar.gearDate)}if(hlCalendar.listener.getAttribute("data-hl-calendar")!=null){var a=hlCalendar.listener.getAttribute("data-hl-calendar").split(",");var d=a[0];var c=d.split("-");hlCalendar.params.minY=~~c[0];hlCalendar.params.minM=~~c[1];hlCalendar.params.minD=~~c[2];var g=a[1];var b=g.split("-");hlCalendar.params.maxY=~~b[0];passY=hlCalendar.params.maxY-hlCalendar.params.minY+1;hlCalendar.params.maxM=~~b[1];hlCalendar.params.maxD=~~b[2]}dateCtrlInit();if(!hlCalendar.gearDate.style.display||hlCalendar.gearDate.style.display=="none"){hlCalendar.gearDate.style.display="block"}}function dateCtrlInit(){var a=new Date();var b={yy:a.getYear(),mm:a.getMonth(),dd:a.getDate()-1};if(/^\d{4}-\d{1,2}-\d{1,2}$/.test(hlCalendar.listener.value)){rs=hlCalendar.listener.value.match(/(^|-)\d{1,4}/g);b.yy=rs[0]-hlCalendar.params.minY;b.mm=rs[1].replace(/-/g,"")-1;b.dd=rs[2].replace(/-/g,"")-1}else{b.yy=b.yy+1900-hlCalendar.params.minY}hlCalendar.gearDate.querySelector(".date_yy").setAttribute("val",b.yy);hlCalendar.gearDate.querySelector(".date_mm").setAttribute("val",b.mm);hlCalendar.gearDate.querySelector(".date_dd").setAttribute("val",b.dd);setDateGear()}function setDateGear(){var k=hlCalendar.gearDate.querySelector(".date_yy");var m="";if(k&&k.getAttribute("val")){var c=parseInt(k.getAttribute("val"));for(var b=0;b<=passY-1;b++){m+="<div class='tooth'>"+(hlCalendar.params.minY+b)+"</div>"}k.innerHTML=m;var j=Math.floor(parseFloat(k.style.top));if(!isNaN(j)){j%2==0?(j=j):(j=j+1);j>8&&(j=8);var f=8-(passY-1)*2;j<f&&(j=f);k.style.top=j+"em";c=Math.abs(j-8)/2;k.setAttribute("val",c)}else{k.style.top=8-c*2+"em"}}else{return}var h=hlCalendar.gearDate.querySelector(".date_mm");if(h&&h.getAttribute("val")){m="";var e=parseInt(h.getAttribute("val"));var i=12;minM=1;if(c==passY-1){i=hlCalendar.params.maxM}if(c==0){minM=hlCalendar.params.minM}var j=Math.floor(parseFloat(h.style.top));if(!isNaN(j)){j%2==0?(j=j):(j=j+1);j>8&&(j=8);var f=8-(i-minM)*2;j<f&&(j=f);h.style.top=j+"em";e=Math.abs(j-8)/2;h.setAttribute("val",e)}else{h.style.top=8-e*2+"em"}for(var b=0;b<(i-minM+1);b++){m+="<div class='tooth'>"+(minM+b)+"</div>"}h.innerHTML=m}else{return}var a=hlCalendar.gearDate.querySelector(".date_dd");if(a&&a.getAttribute("val")){m="";var g=parseInt(a.getAttribute("val"));var d=calcDays(c,e);var l=d;minD=1;if(c==passY-1&&hlCalendar.params.maxM==e+1){l=hlCalendar.params.maxD}if(c==0&&e==0){minD=hlCalendar.params.minD}var j=Math.floor(parseFloat(a.style.top));if(!isNaN(j)){j%2==0?(j=j):(j=j+1);j>8&&(j=8);var f=8-(l-minD)*2;j<f&&(j=f);a.style.top=j+"em";g=Math.abs(j-8)/2;a.setAttribute("val",g)}else{a.style.top=8-g*2+"em"}for(var b=0;b<(l-minD+1);b++){m+="<div class='tooth'>"+(minD+b)+"</div>"}a.innerHTML=m}else{return}}function calcDays(a,b){if(b==1){a+=hlCalendar.params.minY;if((a%4==0&&a%100!=0)||(a%400==0&&a%4000!=0)){return 29}else{return 28}}else{if(b==3||b==5||b==8||b==10){return 30}else{return 31}}}function cancelDateEdit(){hlCalendar.gearDate.style.display="none"}function cancelTimeEdit(){hlCalendar.gearTime.style.display="none"}function finishDateEdit(){var b=parseInt(hlCalendar.gearDate.querySelector(".date_yy").getAttribute("val"));var a=parseInt(hlCalendar.gearDate.querySelector(".date_mm").getAttribute("val"))+minM-1;a=a%12+1;a=a>9?a:"0"+a;var c=parseInt(hlCalendar.gearDate.querySelector(".date_dd").getAttribute("val"))+minD-1;c=c%calcDays(b,a)+1;c=c>9?c:"0"+c;hlCalendar.listener.value=(b%passY+hlCalendar.params.minY)+"-"+a+"-"+c;cancelDateEdit()}function editDatetime(f){hlCalendar.listener=f.target;hlCalendar.gearDate=document.querySelector(".gearDatetime");if(!hlCalendar.gearDate){hlCalendar.gearDate=document.createElement("div");hlCalendar.gearDate.className="gearDatetime";hlCalendar.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn" onclick="cancelDateEdit();">取消</div><div class="date_btn" onclick="finishDatetimeEdit();">确定</div></div><div class="date_roll_mask"><div class="datetime_roll"><div><div class="gear date_yy" data-datetype="date_yy" ontouchstart="gearTouchStart(event)" ontouchmove="gearTouchMove(event)" ontouchend="gearTouchEnd(event)" onmousewheel="gearScroll(event)"></div><div class="date_grid" onmousewheel="gearScroll(event)"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm" ontouchstart="gearTouchStart(event)" ontouchmove="gearTouchMove(event)" ontouchend="gearTouchEnd(event)" onmousewheel="gearScroll(event)"></div><div class="date_grid" onmousewheel="gearScroll(event)"><div>月</div></div></div><div><div class="gear date_dd" data-datetype="date_dd" ontouchstart="gearTouchStart(event)" ontouchmove="gearTouchMove(event)" ontouchend="gearTouchEnd(event)" onmousewheel="gearScroll(event)"></div><div class="date_grid" onmousewheel="gearScroll(event)"><div>日</div></div></div><div><div class="gear time_hh" data-datetype="time_hh" ontouchstart="gearTouchStart(event)" ontouchmove="gearTouchMove(event)" ontouchend="gearTouchEnd(event)" onmousewheel="gearScroll(event)"></div><div class="date_grid" onmousewheel="gearScroll(event)"><div>时</div></div></div><div><div class="gear time_mm" data-datetype="time_mm" ontouchstart="gearTouchStart(event)" ontouchmove="gearTouchMove(event)" ontouchend="gearTouchEnd(event)" onmousewheel="gearScroll(event)"></div><div class="date_grid" onmousewheel="gearScroll(event)"><div>分</div></div></div></div></div></div>';document.body.appendChild(hlCalendar.gearDate)}if(hlCalendar.listener.getAttribute("data-hl-calendar")!=null){var a=hlCalendar.listener.getAttribute("data-hl-calendar").split(",");var d=a[0];var c=d.split("-");hlCalendar.params.minY=~~c[0];hlCalendar.params.minM=~~c[1];hlCalendar.params.minD=~~c[2];var g=a[1];var b=g.split("-");hlCalendar.params.maxY=~~b[0];passY=hlCalendar.params.maxY-hlCalendar.params.minY+1;hlCalendar.params.maxM=~~b[1];hlCalendar.params.maxD=~~b[2]}dateTimeCtrlInit(hlCalendar.gearDate);if(!hlCalendar.gearDate.style.display||hlCalendar.gearDate.style.display=="none"){hlCalendar.gearDate.style.display="block"}}function dateTimeCtrlInit(c){var a=new Date();var b={yy:a.getYear(),mm:a.getMonth(),dd:a.getDate()-1,hh:a.getHours(),mi:a.getMinutes()};if(/^\d{4}-\d{1,2}-\d{1,2}\s\d{2}:\d{2}$/.test(hlCalendar.listener.value)){rs=hlCalendar.listener.value.match(/(^|-|\s|:)\d{1,4}/g);b.yy=rs[0]-hlCalendar.params.minY;b.mm=rs[1].replace(/-/g,"")-1;b.dd=rs[2].replace(/-/g,"")-1;b.hh=parseInt(rs[3].replace(/\s0?/g,""));b.mi=parseInt(rs[4].replace(/:0?/g,""))}else{b.yy=b.yy+1900-hlCalendar.params.minY}c.querySelector(".date_yy").setAttribute("val",b.yy);c.querySelector(".date_mm").setAttribute("val",b.mm);c.querySelector(".date_dd").setAttribute("val",b.dd);setDateGear();c.querySelector(".time_hh").setAttribute("val",b.hh);c.querySelector(".time_mm").setAttribute("val",b.mi);setTimeGear(c)}function finishDatetimeEdit(){hlCalendar.gearDate.style.display="none";var b=parseInt(hlCalendar.gearDate.querySelector(".date_yy").getAttribute("val"));var a=parseInt(hlCalendar.gearDate.querySelector(".date_mm").getAttribute("val"))+minM-1;a=a%12+1;a=a>9?a:"0"+a;var d=parseInt(hlCalendar.gearDate.querySelector(".date_dd").getAttribute("val"))+minD-1;d=d%calcDays(b,a)+1;d=d>9?d:"0"+d;var c=hlCalendar.gearDate.querySelector(".time_hh").getAttribute("val");var e=hlCalendar.gearDate.querySelector(".time_mm").getAttribute("val");hlCalendar.listener.value=(b%passY+hlCalendar.params.minY)+"-"+a+"-"+d+" "+(c.length<2?"0":"")+c+(e.length<2?":0":":")+e}function editTime(a){hlCalendar.listener=a.target;hlCalendar.gearTime=document.querySelector(".gearTime");if(!hlCalendar.gearTime){hlCalendar.gearTime=document.createElement("div");hlCalendar.gearTime.className="gearTime";hlCalendar.gearTime.innerHTML='<div class="time_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn" onclick="cancelTimeEdit();">取消</div><div class="date_btn" onclick="finishTimeEdit();">确定</div></div><div class="date_roll_mask"><div class="time_roll"><div><div class="gear time_hh" data-datetype="time_hh" ontouchstart="gearTouchStart(event)" ontouchmove="gearTouchMove(event)" ontouchend="gearTouchEnd(event)" onmousewheel="gearScroll(event)"></div><div class="date_grid" onmousewheel="gearScroll(event)"><div>时</div></div></div><div><div class="gear time_mm" data-datetype="time_mm" ontouchstart="gearTouchStart(event)" ontouchmove="gearTouchMove(event)" ontouchend="gearTouchEnd(event)" onmousewheel="gearScroll(event)"></div><div class="date_grid" onmousewheel="gearScroll(event)"><div>分</div></div></div></div></div></div>';document.body.appendChild(hlCalendar.gearTime)}timeCtrlInit(hlCalendar.gearTime);if(!hlCalendar.gearTime.style.display||hlCalendar.gearTime.style.display=="none"){hlCalendar.gearTime.style.display="block"}}function timeCtrlInit(b){var c=new Date();var a={hh:c.getHours(),mm:c.getMinutes()};if(/^\d{2}:\d{2}$/.test(hlCalendar.listener.value)){rs=hlCalendar.listener.value.match(/(^|:)\d{2}/g);a.hh=parseInt(rs[0].replace(/^0?/g,""));a.mm=parseInt(rs[1].replace(/:0?/g,""))}b.querySelector(".time_hh").setAttribute("val",a.hh);b.querySelector(".time_mm").setAttribute("val",a.mm);setTimeGear(b)}function setTimeGear(f){var b=f.querySelector(".time_hh");if(b&&b.getAttribute("val")){var c="";var h=parseInt(b.getAttribute("val"));b.style.top=8-h*2+"em";for(var d=0;d<=23;d++){c+="<div class='tooth'>"+d+"</div>"}b.innerHTML=c}else{return}var e=f.querySelector(".time_mm");if(e&&e.getAttribute("val")){var c="";var a=parseInt(e.getAttribute("val"));e.style.top=8-a*2+"em";for(var d=0;d<=59;d++){c+="<div class='tooth'>"+d+"</div>"}e.innerHTML=c}else{return}}function finishTimeEdit(){hlCalendar.gearTime.style.display="none";var a=hlCalendar.gearTime.querySelector(".time_hh").getAttribute("val");var b=hlCalendar.gearTime.querySelector(".time_mm").getAttribute("val");hlCalendar.listener.value=(a.length<2?"0":"")+a+(b.length<2?":0":":")+b}function gearTouchStart(c){c.preventDefault();var b=c.target;var a=this;while(true){if(!b.classList.contains("gear")){b=b.parentElement}else{break}}a["old_"+b.id]=c.targetTouches[0].screenY;a["o_t_"+b.id]=(new Date()).getTime();if(b.style.top){if(/em/.test(b.style.top)){a["o_d_"+b.id]=parseFloat(b.style.top.replace(/em/g,""))}else{if(/px/.test(b.style.top)){a["o_d_"+b.id]=parseFloat(b.style.top.replace(/px/g,""))*18/b.clientHeight}else{a["o_d_"+b.id]=0}}}else{a["o_d_"+b.id]=0}}function gearTouchMove(d){d.preventDefault();var c=d.target;var a=this;while(true){if(!c.classList.contains("gear")){c=c.parentElement}else{break}}a["new_"+c.id]=d.targetTouches[0].screenY;a["n_t_"+c.id]=(new Date()).getTime();var b=(a["new_"+c.id]-a["old_"+c.id])*18/370;a["pos_"+c.id]=a["o_d_"+c.id]+b;c.style.top=a["pos_"+c.id]+"em"}function gearTouchEnd(d){d.preventDefault();var c=d.target;var b=this;while(true){if(!c.classList.contains("gear")){c=c.parentElement}else{break}}var a=(b["new_"+c.id]-b["old_"+c.id])/(b["n_t_"+c.id]-b["o_t_"+c.id]);if(Math.abs(a)<=0.2){b["spd_"+c.id]=(a<0?-0.08:0.08)}else{if(Math.abs(a)<=0.5){b["spd_"+c.id]=(a<0?-0.16:0.16)}else{b["spd_"+c.id]=a/2}}if(!b["pos_"+c.id]){b["pos_"+c.id]=0}setGear(c)}function setGear(g){var e=parseFloat(g.getAttribute("val"));switch(g.dataset.datetype){case"date_yy":var h=Math.floor(parseFloat(g.style.top));h%2==0?(h=h):(h=h+1);h>8&&(h=8);var d=8-(passY-1)*2;h<d&&(h=d);g.style.top=h+"em";e=Math.abs(h-8)/2;break;case"date_mm":var h=Math.floor(parseFloat(g.style.top));h%2==0?(h=h):(h=h+1);h>8&&(h=8);var d=-14;h<d&&(h=d);g.style.top=h+"em";e=Math.abs(h-8)/2;break;case"date_dd":var i=hlCalendar.gearDate.querySelector(".date_yy");var f=hlCalendar.gearDate.querySelector(".date_mm");var a=parseInt(i.getAttribute("val"));var c=parseInt(f.getAttribute("val"));var b=calcDays(a,c);var h=Math.floor(parseFloat(g.style.top));h%2==0?(h=h):(h=h+1);h>8&&(h=8);var d=8-(b-1)*2;h<d&&(h=d);g.style.top=h+"em";e=Math.abs(h-8)/2;break;case"time_hh":var h=Math.floor(parseFloat(g.style.top));h%2==0?(h=h):(h=h+1);h>8&&(h=8);h<-38&&(h=-38);g.style.top=h+"em";e=Math.abs(h-8)/2;break;case"time_mm":var h=Math.floor(parseFloat(g.style.top));h%2==0?(h=h):(h=h+1);h>8&&(h=8);h<-110&&(h=-110);g.style.top=h+"em";e=Math.abs(h-8)/2;break;default:}g.setAttribute("val",e);if(/date/.test(g.dataset.datetype)){setDateGear()}else{}};